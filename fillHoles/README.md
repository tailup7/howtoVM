# fillHolesとは

# 用途
医用画像から輝度値で判別した血管領域をセグメンテーションし、3次元形状を得るのが血管形状モデリングの最初のワークフローだが、この際に得られる3次元形状では、端面(血流の流入面と流出面)は穴が開いている。 <br>
一方で、流入面や流出面は塞がっていないと(閉じた領域でないと)、ICEM CFD でメッシュを切ることができない(流れのINLETやOUTLETを面として指定するため)(*1)。
セグメンテーションした血管形状のうち、一部を切り出して使う場合はmeshmixerで切り出す際に端面を塞いでくれるが、セグメンテーションした形状すべてを流体解析したい場合や、自身で3DCGソフトウェアを使ってチューブ形状を作成した場合など、両端が穴が開いている形状に対してICEMでメッシュを切りたいときは、端面を埋める処理が必要になる。<br>
(はじめは Blendy 等の3DCGソフトウェアで、GUIで端面を追加する方法を試したが、ICEMでメッシュを切る段階でエラーが出た)

# 参考
https://examples.vtk.org/site/PythonicAPI/Meshes/FillHoles/   <br>
上記サイトを参考にしている。tutorial フォルダでは、上記のサンプルコードの動作確認をしている。下のように、穴の開いた球体(左側)の穴が、三角形パッチで埋められている(右側)。<br>
閉じたい領域が単純な形状なら、境界線上のNode数が多くてもfillHoles処理で埋めることができる(fillHoles_vascular)。

<br>

## tutorial
![a](../assets/a.gif)

## fillHoles_vascular
![b](../assets/b.png)
<br>
stlファイルを読み込み、端面を埋める処理をしてstlとして出力する。上の図で、左は処理前の形状で、右は処理後の形状。端面が埋まっていることが確認できるが、拡大してみると三角形パッチの形が悪く、表面がギザギザしている。このように端面を追加した形状から、ICEM CFD でテトラ-プリズム複合メッシュに分割した結果が下の図。ギザギザしていた部分に対応する、外側メッシュ(=プリズムメッシュ)が歪んでいる。反対側の端面はきれいにメッシュが切れた。OpenFOAMで計算が実行でき、gmshでメッシュを作成した場合と比較して似たような計算結果が出たので、ひとまずよしとする。ICEM CFD で作成したこのメッシュファイルはassetsにある。

<br>

<img src="../assets/c.png" width="587" height="422" />

<br>
<br>
<br>

#### 注釈
*1 ... <br>
vmtk (Vascular Modeling Toolkit) にはstlデータからテトラプリズム複合メッシュを切る機能もあって、元のstlは管壁のみでよく、流入面や流出面が空いていていいらしい <br>
https://www.rccm.co.jp/icem/pukiwiki/index.php?%E8%A1%A8%E9%9D%A2%E3%83%A1%E3%83%83%E3%82%B7%E3%83%A5%E3%81%8B%E3%82%89%E3%83%97%E3%83%AA%E3%82%BA%E3%83%A0%E3%83%A1%E3%83%83%E3%82%B7%E3%83%A5%E3%81%AE%E4%BD%9C%E6%88%90%28vmtk%29     <br>
さすがにメッシュの精度は有料のICEMの方がいいと思うが、時間があれば試してみたい。
